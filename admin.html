
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Enhanced Campaign Board</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
        // Admin Panel Component
        function AdminPanel() {
            // State management
            const [isAuthenticated, setIsAuthenticated] = React.useState(false);
            const [username, setUsername] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [loginError, setLoginError] = React.useState('');
            
            // Admin data states
            const [campaigns, setCampaigns] = React.useState([]);
            const [allConfessions, setAllConfessions] = React.useState([]);
            const [users, setUsers] = React.useState([]);
            const [systemStats, setSystemStats] = React.useState({});
            const [activeTab, setActiveTab] = React.useState('dashboard');
            const [selectedCampaign, setSelectedCampaign] = React.useState(null);
            const [editingCampaign, setEditingCampaign] = React.useState(null);
            const [newCampaign, setNewCampaign] = React.useState({
                title: '',
                description: '',
                type: 'text',
                is_active: true
            });
            const [filterText, setFilterText] = React.useState('');
            const [statusFilter, setStatusFilter] = React.useState('all');
            const [dateRange, setDateRange] = React.useState({
                start: '',
                end: ''
            });

            // -------------------------------------------------------------------------
            // Supabase initialization
            //
            // This admin panel now uses Supabase to persist campaigns and posts.  The
            // URL and anonymous key point to your Supabase project.  If they need
            // to change, update them here.  The supabase-js library is loaded
            // globally at the top of this document.
            const SUPABASE_URL = 'https://zfzydjiqxgrnxnvimnqi.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmenlkamlxeGdybnhudmltbnFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MzYwMjksImV4cCI6MjA3MTIxMjAyOX0.M8lGPIKIAjqQ09ujp-uaXn-3dZNYx5pYSAk28wafP8A';
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // Admin credentials (in a real app, these would be securely stored)
            const ADMIN_CREDENTIALS = {
                username: "wagadugu",
                password: "1@2#3$4_Qwer"
            };

            // Check if user is already logged in
            React.useEffect(() => {
                const adminAuth = localStorage.getItem('adminAuthenticated');
                if (adminAuth === 'true') {
                    setIsAuthenticated(true);
                    loadAdminData();
                }
            }, []);

            // Load admin data from Supabase
            const loadAdminData = async () => {
                try {
                    // Fetch all campaigns (including inactive) ordered by creation date
                    const { data: campaignData, error: campaignError } = await supabaseClient
                        .from('campaigns')
                        .select('*')
                        .order('created_at', { ascending: true });
                    if (campaignError) {
                        console.error('Error fetching campaigns:', campaignError);
                    }
                    setCampaigns(campaignData || []);
                    // Fetch all confessions
                    const { data: confData, error: confError } = await supabaseClient
                        .from('confessions')
                        .select('*');
                    if (confError) {
                        console.error('Error fetching posts:', confError);
                    }
                    setAllConfessions(confData || []);
                    const campaignsList = campaignData || [];
                    const confessionsList = confData || [];
                    // Build user statistics
                    const userMap = {};
                    confessionsList.forEach(conf => {
                        if (!userMap[conf.owner]) {
                            userMap[conf.owner] = {
                                id: conf.owner,
                                name: conf.name,
                                postCount: 0,
                                lastActive: conf.created_at,
                                campaigns: {}
                            };
                        }
                        userMap[conf.owner].postCount++;
                        userMap[conf.owner].lastActive = conf.created_at > userMap[conf.owner].lastActive ? 
                            conf.created_at : userMap[conf.owner].lastActive;
                        if (!userMap[conf.owner].campaigns[conf.campaign_id]) {
                            userMap[conf.owner].campaigns[conf.campaign_id] = 0;
                        }
                        userMap[conf.owner].campaigns[conf.campaign_id]++;
                    });
                    setUsers(Object.values(userMap));
                    // Calculate system statistics
                    const stats = {
                        totalPosts: confessionsList.length,
                        totalUsers: Object.keys(userMap).length,
                        activeCampaigns: campaignsList.filter(c => c.is_active).length,
                        textPosts: confessionsList.filter(c => c.type === 'text').length,
                        imagePosts: confessionsList.filter(c => c.type === 'image').length,
                        last24hPosts: confessionsList.filter(c => {
                            const postDate = new Date(c.created_at);
                            const now = new Date();
                            return (now - postDate) < (24 * 60 * 60 * 1000);
                        }).length
                    };
                    setSystemStats(stats);
                } catch (err) {
                    console.error('Unexpected error loading admin data:', err);
                }
            };

            // Listen for changes to campaigns and confessions in real time.  When a
            // campaign is created, updated or deleted or when a post is added,
            // updated or removed, refresh the admin data to reflect the latest
            // state.  This makes the admin panel reactive without requiring
            // manual refreshes.
            React.useEffect(() => {
                const campaignChannel = supabaseClient.channel('public:campaigns')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'campaigns'
                    }, () => {
                        loadAdminData();
                    })
                    .subscribe();
                const confessionChannel = supabaseClient.channel('public:confessions')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'confessions'
                    }, () => {
                        loadAdminData();
                    })
                    .subscribe();
                return () => {
                    supabaseClient.removeChannel(campaignChannel);
                    supabaseClient.removeChannel(confessionChannel);
                };
            }, []);

            // Handle login
            const handleLogin = (e) => {
                e.preventDefault();
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    setIsAuthenticated(true);
                    setLoginError('');
                    localStorage.setItem('adminAuthenticated', 'true');
                    loadAdminData();
                } else {
                    setLoginError('Invalid credentials');
                }
            };

            // Handle logout
            const handleLogout = () => {
                setIsAuthenticated(false);
                localStorage.removeItem('adminAuthenticated');
            };

            // Handle campaign status change
            const toggleCampaignStatus = async (campaignId) => {
                const campaign = campaigns.find(c => c.id === campaignId);
                if (!campaign) return;
                const newStatus = !campaign.is_active;
                // Persist change to Supabase
                try {
                    const { error } = await supabaseClient
                        .from('campaigns')
                        .update({ is_active: newStatus })
                        .eq('id', campaignId);
                    if (error) {
                        console.error('Error updating campaign status:', error);
                        return;
                    }
                    setCampaigns(prev => prev.map(c => c.id === campaignId ? { ...c, is_active: newStatus } : c));
                } catch (err) {
                    console.error('Unexpected error updating campaign status:', err);
                }
            };

            // Handle campaign deletion
            const deleteCampaign = async (campaignId) => {
                if (!window.confirm('Are you sure you want to delete this campaign? All associated posts will also be deleted.')) return;
                try {
                    // Delete all posts associated with this campaign
                    const { error: postsError } = await supabaseClient
                        .from('confessions')
                        .delete()
                        .eq('campaign_id', campaignId);
                    if (postsError) {
                        console.error('Error deleting associated posts:', postsError);
                        // continue anyway to delete campaign
                    }
                    // Delete campaign
                    const { error: campError } = await supabaseClient
                        .from('campaigns')
                        .delete()
                        .eq('id', campaignId);
                    if (campError) {
                        console.error('Error deleting campaign:', campError);
                        return;
                    }
                    // Update local state
                    setCampaigns(prev => prev.filter(c => c.id !== campaignId));
                    setAllConfessions(prev => prev.filter(c => c.campaign_id !== campaignId));
                    // Refresh statistics
                    loadAdminData();
                } catch (err) {
                    console.error('Unexpected error deleting campaign:', err);
                }
            };

            // Handle confession deletion
            const deleteConfession = async (confessionId) => {
                if (!window.confirm('Are you sure you want to delete this post?')) return;
                try {
                    const { error } = await supabaseClient
                        .from('confessions')
                        .delete()
                        .eq('id', confessionId);
                    if (error) {
                        console.error('Error deleting post:', error);
                        return;
                    }
                    setAllConfessions(prev => prev.filter(c => c.id !== confessionId));
                    // Refresh statistics
                    loadAdminData();
                } catch (err) {
                    console.error('Unexpected error deleting post:', err);
                }
            };

            // Handle campaign editing
            const startEditingCampaign = (campaign) => {
                setEditingCampaign({ ...campaign });
            };

            // Save campaign edits
            const saveCampaignEdit = async () => {
                if (!editingCampaign.title.trim()) {
                    alert('Campaign title is required');
                    return;
                }
                try {
                    const { error } = await supabaseClient
                        .from('campaigns')
                        .update({
                            title: editingCampaign.title,
                            description: editingCampaign.description,
                            type: editingCampaign.type,
                            is_active: editingCampaign.is_active
                        })
                        .eq('id', editingCampaign.id);
                    if (error) {
                        console.error('Error saving campaign changes:', error);
                        return;
                    }
                    setCampaigns(prev => prev.map(c => c.id === editingCampaign.id ? { ...c, ...editingCampaign } : c));
                    setEditingCampaign(null);
                } catch (err) {
                    console.error('Unexpected error saving campaign changes:', err);
                }
            };

            // Handle new campaign creation
            const handleNewCampaignChange = (e) => {
                const { name, value, type, checked } = e.target;
                setNewCampaign(prev => ({
                    ...prev,
                    [name]: type === 'checkbox' ? checked : value
                }));
            };

            // Create new campaign
           // Create new campaign (Supabase + visible error)
const createNewCampaign = async () => {
  if (!newCampaign.title.trim()) {
    alert('Campaign title is required');
    return;
  }

  const campaign = {
    id: `campaign-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
    title: newCampaign.title.trim(),
    description: newCampaign.description?.trim() || '',
    type: newCampaign.type || 'text',            // 'text' | 'image'
    is_active: !!newCampaign.is_active,
    created_at: new Date().toISOString()
  };

  const { data, error } = await supabaseClient
    .from('campaigns')
    .insert([campaign])
    .select()
    .single();

  if (error) {
    alert(`Create failed: ${error.message}`);
    console.error('createNewCampaign error', error);
    return;
  }

  // Use the row returned by Supabase (in case DB adds defaults)
  setCampaigns(prev => [...prev, data]);

  // Reset and close the form panel
  setNewCampaign({ title: '', description: '', type: 'text', is_active: true });
  setSelectedCampaign(null);
};


            // Filter confessions based on filters
            const filteredConfessions = allConfessions.filter(confession => {
                // Text filter
                const textMatch = filterText === '' || 
                    (confession.text && confession.text.toLowerCase().includes(filterText.toLowerCase())) ||
                    confession.name.toLowerCase().includes(filterText.toLowerCase()) ||
                    confession.id.toLowerCase().includes(filterText.toLowerCase());
                
                // Status filter (based on campaign status)
                let statusMatch = true;
                if (statusFilter !== 'all') {
                    const campaign = campaigns.find(c => c.id === confession.campaign_id);
                    statusMatch = statusFilter === 'active' ? campaign.is_active : !campaign.is_active;
                }
                
                // Date filter
                let dateMatch = true;
                if (dateRange.start && dateRange.end) {
                    const postDate = new Date(confession.created_at);
                    const startDate = new Date(dateRange.start);
                    const endDate = new Date(dateRange.end);
                    endDate.setDate(endDate.getDate() + 1); // Include end date
                    
                    dateMatch = postDate >= startDate && postDate <= endDate;
                }
                
                return textMatch && statusMatch && dateMatch;
            });

            // Export data as CSV
            const exportData = (type) => {
                let dataToExport = [];
                let filename = '';
                
                if (type === 'confessions') {
                    dataToExport = allConfessions.map(conf => ({
                        id: conf.id,
                        campaign: campaigns.find(c => c.id === conf.campaign_id)?.title || 'Unknown',
                        user: conf.name,
                        userId: conf.owner,
                        type: conf.type,
                        content: conf.text || 'Image Post',
                        createdAt: new Date(conf.created_at).toLocaleString(),
                        position: `X: ${conf.x}, Y: ${conf.y}`,
                        dimensions: `W: ${conf.w}, H: ${conf.h}`,
                        rotation: `${Math.round((conf.rot * 180) / Math.PI)}Â°`
                    }));
                    filename = `campaign_posts_export_${new Date().toISOString().slice(0, 10)}.csv`;
                } else if (type === 'users') {
                    dataToExport = users.map(user => ({
                        id: user.id,
                        name: user.name,
                        postCount: user.postCount,
                        lastActive: new Date(user.lastActive).toLocaleString(),
                        campaigns: Object.keys(user.campaigns).length
                    }));
                    filename = `campaign_users_export_${new Date().toISOString().slice(0, 10)}.csv`;
                } else if (type === 'campaigns') {
                    dataToExport = campaigns.map(campaign => ({
                        id: campaign.id,
                        title: campaign.title,
                        description: campaign.description,
                        type: campaign.type,
                        status: campaign.is_active ? 'Active' : 'Inactive',
                        createdAt: new Date(campaign.created_at).toLocaleString(),
                        postCount: allConfessions.filter(c => c.campaign_id === campaign.id).length
                    }));
                    filename = `campaigns_export_${new Date().toISOString().slice(0, 10)}.csv`;
                }
                
                // Convert to CSV
                const headers = Object.keys(dataToExport[0] || {});
                let csv = headers.join(',') + '\n';
                
                dataToExport.forEach(row => {
                    const values = headers.map(header => {
                        const value = row[header];
                        return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                    });
                    csv += values.join(',') + '\n';
                });
                
                // Download
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // Login form if not authenticated
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
                        <div className="max-w-md w-full space-y-8">
                            <div>
                                <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
                                    Admin Sign In
                                </h2>
                                <p className="mt-2 text-center text-sm text-gray-600">
                                    Enhanced Campaign Board Administration
                                </p>
                            </div>
                            <form className="mt-8 space-y-6" onSubmit={handleLogin}>
                                <div className="rounded-md shadow-sm -space-y-px">
                                    <div>
                                        <label htmlFor="username" className="sr-only">Username</label>
                                        <input
                                            id="username"
                                            name="username"
                                            type="text"
                                            required
                                            className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                                            placeholder="Username"
                                            value={username}
                                            onChange={e => setUsername(e.target.value)}
                                        />
                                    </div>
                                    <div>
                                        <label htmlFor="password" className="sr-only">Password</label>
                                        <input
                                            id="password"
                                            name="password"
                                            type="password"
                                            required
                                            className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                                            placeholder="Password"
                                            value={password}
                                            onChange={e => setPassword(e.target.value)}
                                        />
                                    </div>
                                </div>

                                {loginError && (
                                    <div className="text-red-600 text-sm text-center">{loginError}</div>
                                )}

                                <div>
                                    <button
                                        type="submit"
                                        className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                    >
                                        Sign in
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            // Main admin panel
            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Header */}
                    <header className="bg-white shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16 items-center">
                                <div className="flex items-center">
                                    <h1 className="text-xl font-bold text-gray-900">Campaign Board Admin</h1>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <a 
                                        href="index.html" 
                                        className="text-sm text-indigo-600 hover:text-indigo-800"
                                    >
                                        <i className="fas fa-arrow-left mr-1"></i>
                                        Back to Campaign
                                    </a>
                                    <button
                                        onClick={handleLogout}
                                        className="text-sm bg-gray-200 hover:bg-gray-300 text-gray-800 py-1.5 px-3 rounded-lg transition-colors"
                                    >
                                        <i className="fas fa-sign-out-alt mr-1"></i>
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <div className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <nav className="flex space-x-8 overflow-x-auto">
                                <button
                                    onClick={() => setActiveTab('dashboard')}
                                    className={`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${activeTab === 'dashboard' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}
                                >
                                    <i className="fas fa-chart-line mr-1.5"></i>
                                    Dashboard
                                </button>
                                <button
                                    onClick={() => setActiveTab('campaigns')}
                                    className={`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${activeTab === 'campaigns' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}
                                >
                                    <i className="fas fa-bullhorn mr-1.5"></i>
                                    Campaigns
                                </button>
                                <button
                                    onClick={() => setActiveTab('content')}
                                    className={`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${activeTab === 'content' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}
                                >
                                    <i className="fas fa-sticky-note mr-1.5"></i>
                                    Content Management
                                </button>
                                <button
                                    onClick={() => setActiveTab('users')}
                                    className={`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${activeTab === 'users' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}
                                >
                                    <i className="fas fa-users mr-1.5"></i>
                                    Users
                                </button>
                                <button
                                    onClick={() => setActiveTab('export')}
                                    className={`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${activeTab === 'export' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}
                                >
                                    <i className="fas fa-download mr-1.5"></i>
                                    Export Data
                                </button>
                            </nav>
                        </div>
                    </div>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {/* Dashboard Tab */}
                        {activeTab === 'dashboard' && (
                            <div>
                                <h2 className="text-lg font-semibold text-gray-900 mb-6">System Overview</h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white overflow-hidden shadow rounded-lg">
                                        <div className="px-4 py-5 sm:p-6">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                                                    <i className="fas fa-bullhorn text-white text-xl"></i>
                                                </div>
                                                <div className="ml-5 w-0 flex-1">
                                                    <dl>
                                                        <dt className="text-sm font-medium text-gray-500 truncate">Active Campaigns</dt>
                                                        <dd className="flex items-baseline">
                                                            <div className="text-2xl font-semibold text-gray-900">{systemStats.activeCampaigns || 0}</div>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white overflow-hidden shadow rounded-lg">
                                        <div className="px-4 py-5 sm:p-6">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 bg-green-500 rounded-md p-3">
                                                    <i className="fas fa-sticky-note text-white text-xl"></i>
                                                </div>
                                                <div className="ml-5 w-0 flex-1">
                                                    <dl>
                                                        <dt className="text-sm font-medium text-gray-500 truncate">Total Posts</dt>
                                                        <dd className="flex items-baseline">
                                                            <div className="text-2xl font-semibold text-gray-900">{systemStats.totalPosts || 0}</div>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white overflow-hidden shadow rounded-lg">
                                        <div className="px-4 py-5 sm:p-6">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                                    <i className="fas fa-users text-white text-xl"></i>
                                                </div>
                                                <div className="ml-5 w-0 flex-1">
                                                    <dl>
                                                        <dt className="text-sm font-medium text-gray-500 truncate">Total Users</dt>
                                                        <dd className="flex items-baseline">
                                                            <div className="text-2xl font-semibold text-gray-900">{systemStats.totalUsers || 0}</div>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white overflow-hidden shadow rounded-lg">
                                        <div className="px-4 py-5 sm:p-6">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 bg-yellow-500 rounded-md p-3">
                                                    <i className="fas fa-clock text-white text-xl"></i>
                                                </div>
                                                <div className="ml-5 w-0 flex-1">
                                                    <dl>
                                                        <dt className="text-sm font-medium text-gray-500 truncate">Last 24h Posts</dt>
                                                        <dd className="flex items-baseline">
                                                            <div className="text-2xl font-semibold text-gray-900">{systemStats.last24hPosts || 0}</div>
                                                        </dd>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="bg-white shadow rounded-lg p-6">
                                        <h3 className="text-lg font-medium text-gray-900 mb-4">Recent Activity</h3>
                                        <div className="flow-root">
                                            <ul className="-mb-8">
                                                {allConfessions.slice(-5).reverse().map((confession, idx) => (
                                                    <li key={confession.id}>
                                                        <div className="relative pb-8">
                                                            {idx !== 4 && (
                                                                <span className="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                                                            )}
                                                            <div className="relative flex space-x-3">
                                                                <div>
                                                                    <span className={`h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white ${confession.type === 'text' ? 'bg-blue-500' : 'bg-purple-500'}`}>
                                                                        <i className={`text-xs text-white ${confession.type === 'text' ? 'fas fa-font' : 'fas fa-image'}`}></i>
                                                                    </span>
                                                                </div>
                                                                <div className="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                                    <div>
                                                                        <p className="text-sm text-gray-700">
                                                                            <span className="font-medium">{confession.name}</span> posted in{' '}
                                                                            <span className="font-medium">
                                                                                {campaigns.find(c => c.id === confession.campaign_id)?.title || 'Unknown Campaign'}
                                                                            </span>
                                                                        </p>
                                                                        {confession.type === 'text' && (
                                                                            <p className="text-sm text-gray-500 truncate">"{confession.text}"</p>
                                                                        )}
                                                                    </div>
                                                                    <div className="text-right text-sm whitespace-nowrap text-gray-500">
                                                                        <time dateTime={confession.created_at}>
                                                                            {new Date(confession.created_at).toLocaleTimeString()}
                                                                        </time>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white shadow rounded-lg p-6">
                                        <h3 className="text-lg font-medium text-gray-900 mb-4">Campaign Summary</h3>
                                        <div className="overflow-hidden">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campaign</th>
                                                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Posts</th>
                                                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {campaigns.map(campaign => (
                                                        <tr key={campaign.id}>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{campaign.title}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize">{campaign.type}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                                {allConfessions.filter(c => c.campaign_id === campaign.id).length}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${campaign.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                                    {campaign.is_active ? 'Active' : 'Inactive'}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Campaigns Tab */}
                        {activeTab === 'campaigns' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-lg font-semibold text-gray-900">Campaign Management</h2>
                                    <button
                                        onClick={() => setSelectedCampaign('new')}
                                        className="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg flex items-center"
                                    >
                                        <i className="fas fa-plus mr-2"></i>
                                        New Campaign
                                    </button>
                                </div>
                                
                                {selectedCampaign === 'new' ? (
                                    <div className="bg-white shadow rounded-lg p-6 mb-6">
                                        <h3 className="text-lg font-medium text-gray-900 mb-4">Create New Campaign</h3>
                                        <div className="grid grid-cols-1 gap-4 mb-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Campaign Title</label>
                                                <input
                                                    type="text"
                                                    name="title"
                                                    value={newCampaign.title}
                                                    onChange={handleNewCampaignChange}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    placeholder="Enter campaign title"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                                <textarea
                                                    name="description"
                                                    value={newCampaign.description}
                                                    onChange={handleNewCampaignChange}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    placeholder="Enter campaign description"
                                                    rows="3"
                                                />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                                    <select
                                                        name="type"
                                                        value={newCampaign.type}
                                                        onChange={handleNewCampaignChange}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    >
                                                        <option value="text">Text Campaign</option>
                                                        <option value="image">Photo Campaign</option>
                                                    </select>
                                                </div>
                                                <div className="flex items-center">
                                                    <input
                                                        id="is_active"
                                                        name="is_active"
                                                        type="checkbox"
                                                        checked={newCampaign.is_active}
                                                        onChange={handleNewCampaignChange}
                                                        className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                                    />
                                                    <label htmlFor="is_active" className="ml-2 block text-sm text-gray-900">
                                                        Active Campaign
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex justify-end space-x-3">
                                            <button
                                                onClick={() => setSelectedCampaign(null)}
                                                className="bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-lg"
                                            >
                                                Cancel
                                            </button>
                                            <button
                                                onClick={createNewCampaign}
                                                className="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg"
                                            >
                                                Create Campaign
                                            </button>
                                        </div>
                                    </div>
                                ) : editingCampaign ? (
                                    <div className="bg-white shadow rounded-lg p-6 mb-6">
                                        <h3 className="text-lg font-medium text-gray-900 mb-4">Edit Campaign</h3>
                                        <div className="grid grid-cols-1 gap-4 mb-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Campaign Title</label>
                                                <input
                                                    type="text"
                                                    value={editingCampaign.title}
                                                    onChange={e => setEditingCampaign({...editingCampaign, title: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                                <textarea
                                                    value={editingCampaign.description}
                                                    onChange={e => setEditingCampaign({...editingCampaign, description: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    rows="3"
                                                />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                                    <select
                                                        value={editingCampaign.type}
                                                        onChange={e => setEditingCampaign({...editingCampaign, type: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    >
                                                        <option value="text">Text Campaign</option>
                                                        <option value="image">Photo Campaign</option>
                                                    </select>
                                                </div>
                                                <div className="flex items-center">
                                                    <input
                                                        id="edit_is_active"
                                                        type="checkbox"
                                                        checked={editingCampaign.is_active}
                                                        onChange={e => setEditingCampaign({...editingCampaign, is_active: e.target.checked})}
                                                        className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                                    />
                                                    <label htmlFor="edit_is_active" className="ml-2 block text-sm text-gray-900">
                                                        Active Campaign
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex justify-end space-x-3">
                                            <button
                                                onClick={() => setEditingCampaign(null)}
                                                className="bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-lg"
                                            >
                                                Cancel
                                            </button>
                                            <button
                                                onClick={saveCampaignEdit}
                                                className="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg"
                                            >
                                                Save Changes
                                            </button>
                                        </div>
                                    </div>
                                ) : null}
                                
                                <div className="bg-white shadow overflow-hidden rounded-lg">
                                    <table className="min-w-full divide-y divide-gray-200">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campaign</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Posts</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {campaigns.map(campaign => (
                                                <tr key={campaign.id}>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm font-medium text-gray-900">{campaign.title}</div>
                                                        <div className="text-sm text-gray-500">{campaign.description}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize">{campaign.type}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        {allConfessions.filter(c => c.campaign_id === campaign.id).length}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${campaign.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                            {campaign.is_active ? 'Active' : 'Inactive'}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div className="flex space-x-2">
                                                            <button
                                                                onClick={() => toggleCampaignStatus(campaign.id)}
                                                                className={`${campaign.is_active ? 'text-yellow-600 hover:text-yellow-900' : 'text-green-600 hover:text-green-900'}`}
                                                            >
                                                                {campaign.is_active ? 'Deactivate' : 'Activate'}
                                                            </button>
                                                            <button
                                                                onClick={() => startEditingCampaign(campaign)}
                                                                className="text-indigo-600 hover:text-indigo-900"
                                                            >
                                                                Edit
                                                            </button>
                                                            <button
                                                                onClick={() => deleteCampaign(campaign.id)}
                                                                className="text-red-600 hover:text-red-900"
                                                            >
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                        
                        {/* Content Management Tab */}
                        {activeTab === 'content' && (
                            <div>
                                <h2 className="text-lg font-semibold text-gray-900 mb-6">Content Management</h2>
                                
                                <div className="bg-white shadow rounded-lg p-6 mb-6">
                                    <h3 className="text-lg font-medium text-gray-900 mb-4">Filters</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Search</label>
                                            <input
                                                type="text"
                                                value={filterText}
                                                onChange={e => setFilterText(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                placeholder="Search posts, users, IDs..."
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Campaign Status</label>
                                            <select
                                                value={statusFilter}
                                                onChange={e => setStatusFilter(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            >
                                                <option value="all">All Statuses</option>
                                                <option value="active">Active Campaigns Only</option>
                                                <option value="inactive">Inactive Campaigns Only</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                                            <div className="flex space-x-2">
                                                <input
                                                    type="date"
                                                    value={dateRange.start}
                                                    onChange={e => setDateRange({...dateRange, start: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                />
                                                <span className="self-center">to</span>
                                                <input
                                                    type="date"
                                                    value={dateRange.end}
                                                    onChange={e => setDateRange({...dateRange, end: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex justify-end">
                                        <button
                                            onClick={() => {
                                                setFilterText('');
                                                setStatusFilter('all');
                                                setDateRange({start: '', end: ''});
                                            }}
                                            className="text-sm text-gray-600 hover:text-gray-800"
                                        >
                                            Clear Filters
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="bg-white shadow overflow-hidden rounded-lg">
                                    <table className="min-w-full divide-y divide-gray-200">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Content</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campaign</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {filteredConfessions.length > 0 ? (
                                                filteredConfessions.map(confession => (
                                                    <tr key={confession.id}>
                                                        <td className="px-6 py-4">
                                                            <div className="text-sm font-medium text-gray-900">
                                                                {confession.type === 'text' ? (
                                                                    <div className="max-w-xs truncate">"{confession.text}"</div>
                                                                ) : (
                                                                    <div className="flex items-center">
                                                                        <i className="fas fa-image text-purple-500 mr-1"></i>
                                                                        <span>Image Post</span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="text-xs text-gray-500">ID: {confession.id}</div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <div className="text-sm text-gray-900">{confession.name}</div>
                                                            <div className="text-xs text-gray-500">User ID: {confession.owner}</div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                            {campaigns.find(c => c.id === confession.campaign_id)?.title || 'Unknown'}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                            {new Date(confession.created_at).toLocaleDateString()}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <button
                                                                onClick={() => deleteConfession(confession.id)}
                                                                className="text-red-600 hover:text-red-900"
                                                            >
                                                                Delete
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))
                                            ) : (
                                                <tr>
                                                    <td colSpan="5" className="px-6 py-4 text-center text-sm text-gray-500">
                                                        No posts found matching your filters
                                                    </td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                        
                        {/* Users Tab */}
                        {activeTab === 'users' && (
                            <div>
                                <h2 className="text-lg font-semibold text-gray-900 mb-6">User Management</h2>
                                
                                <div className="bg-white shadow overflow-hidden rounded-lg">
                                    <table className="min-w-full divide-y divide-gray-200">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Posts</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campaigns</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Active</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {users.map(user => (
                                                <tr key={user.id}>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm font-medium text-gray-900">{user.name}</div>
                                                        <div className="text-xs text-gray-500">ID: {user.id}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        {user.postCount}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        {Object.keys(user.campaigns).length}
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        {new Date(user.lastActive).toLocaleDateString()}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                        
                        {/* Export Tab */}
                        {activeTab === 'export' && (
                            <div>
                                <h2 className="text-lg font-semibold text-gray-900 mb-6">Data Export</h2>
                                
                                <div className="bg-white shadow rounded-lg p-6">
                                    <h3 className="text-lg font-medium text-gray-900 mb-4">Export Data</h3>
                                    <p className="text-sm text-gray-600 mb-6">
                                        Export your campaign data in CSV format for analysis or backup purposes.
                                    </p>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="bg-gray-50 p-4 rounded-lg text-center">
                                            <div className="mx-auto bg-blue-100 p-3 rounded-full w-16 h-16 flex items-center justify-center mb-3">
                                                <i className="fas fa-sticky-note text-blue-600 text-2xl"></i>
                                            </div>
                                            <h4 className="font-medium text-gray-900 mb-2">Posts Data</h4>
                                            <p className="text-sm text-gray-600 mb-4">Export all posts with complete metadata</p>
                                            <button
                                                onClick={() => exportData('confessions')}
                                                className="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm"
                                            >
                                                Export Posts
                                            </button>
                                        </div>
                                        
                                        <div className="bg-gray-50 p-4 rounded-lg text-center">
                                            <div className="mx-auto bg-green-100 p-3 rounded-full w-16 h-16 flex items-center justify-center mb-3">
                                                <i className="fas fa-users text-green-600 text-2xl"></i>
                                            </div>
                                            <h4 className="font-medium text-gray-900 mb-2">User Data</h4>
                                            <p className="text-sm text-gray-600 mb-4">Export user statistics and activity</p>
                                            <button
                                                onClick={() => exportData('users')}
                                                className="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm"
                                            >
                                                Export Users
                                            </button>
                                        </div>
                                        
                                        <div className="bg-gray-50 p-4 rounded-lg text-center">
                                            <div className="mx-auto bg-purple-100 p-3 rounded-full w-16 h-16 flex items-center justify-center mb-3">
                                                <i className="fas fa-bullhorn text-purple-600 text-2xl"></i>
                                            </div>
                                            <h4 className="font-medium text-gray-900 mb-2">Campaign Data</h4>
                                            <p className="text-sm text-gray-600 mb-4">Export campaign details and statistics</p>
                                            <button
                                                onClick={() => exportData('campaigns')}
                                                className="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg text-sm"
                                            >
                                                Export Campaigns
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        // Render the admin panel
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminPanel />);
    </script>
</body>
</html>
